#!/usr/bin/env node
var path = require('path'),
    optimist = require('optimist'),
    survey = require('../lib/survey'),
    argv = optimist.usage('Run a series of benchmarks exported from FILENAME.\nUsage:survey [options] FILENAME [...MORE]')
        .options({
            'count': {
                alias: 'c',
                description: 'An approximate number of times to run each test.',
                'default': 1000
            },
            'verbose': {
                alias: 'v',
                description: 'Print each test as its running for debugging.',
                'default': false
            },
            'help': {
                description: 'Show this help message, then exit.'
            }
        })
        .demand(1)
        .argv;

if (argv.help) {
    optimist.showHelp();
    process.exit();
}

argv._.forEach(function (file) {
    var subject;

    try {
        subject = require(path.resolve(process.cwd(), file));
        survey.run(subject, argv, console.log);
    } catch (e) {
        console.error('Failed to load:', file);
    }
});
